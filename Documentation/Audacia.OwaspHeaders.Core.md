# Audacia.OwaspHeaders.Core

This repo is based on one of Jamie's Open Source repos ([OwaspHeaders.Core](https://github.com/GaProgMan/OwaspHeaders.Core)). It is an ASP NET Core middleware for implementing the [OWASP recommended secure HTTP headers](https://www.owasp.org/index.php/OWASP_Secure_Headers_Project).

#### Note

As of May 3<sup>rd</sup>, 2018: Jamie's middleware (linked above) has more functionality than the Audacia fork of it. In order to see the functionality that will be added to the Audacia fork, visit the GitHub page (linked above) or add his [NuGet package](https://www.nuget.org/packages/OwaspHeaders.Core/) to a _test project_.

---

## Requirements

This middleware is for ASP NET Core, as such it requires ASP NET Core 1.x or above in order to consume it. It does _not+ work with ASP NET applications.

## Basic Usage

In your `Startup.cs` file, add the following using statement:

``` csharp
using Audacia.SecureHeadersMiddleware.Extensions;
```

In the `Configure` method, add the following before any other middleware which can create a response:

``` csharp
var forceHttps = !env.IsDevelopment();

app.UseSecureHeadersMiddleware(
    SecureHeadersMiddlewareExtensions.BuildAngular2TemplateConfiguration(forceHttps)
);
```

### BuildAngular2TemplateConfiguration

The above extension method adds recommended security headers to all of the responses that your application will generate, and looks (currently - as of May 3<sup>rd</sup>, 2018) like this:

``` csharp
public static SecureHeadersMiddlewareConfiguration
    BuildAngular2TemplateConfiguration(bool forceHttps)
{
    return SecureHeadersMiddlewareBuilder
        .CreateBuilder()
        .UseHsts()
        .UseXFrameOptions()
        .UseXSSProtection()
        .UseContentTypeOptions()
        .UseContentSecurityPolicy(blockAllMixedContent: forceHttps, upgradeInsecureRequests: forceHttps)
        .UsePermittedCrossDomainPolicies()
        .UseReferrerPolicy()
        .Build();
}
```

## Advanced Usage

The `SecureHeadersMiddlewareExtensions` class contains methods required to build up a `SecureHeadersMiddlewareConfiguration`. This POCO is then used to apply the chosen headers (and their values) to all responses which are generated by your application.

In order to generate your own `SecureHeadersMiddlewareConfiguration`, create an extension method which returns an instance of that type and use the relevant methods found in the `SecureHeadersMiddlewareBuilder` class to build the configuration.

The custom method _has_ to contain calls to the following methods:

- `CreateBuilder()`
- `Build()`

with methods which populate the configuration being placed between those two methods. This is because Audacia.OwaspHeaders.Core uses the [Builder pattern](https://en.wikipedia.org/wiki/Builder_pattern) to generate instances of the `SecureHeadersMiddlewareConfiguration` POCO.